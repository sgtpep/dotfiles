#!/bin/bash
set -eu
for path in src/@types/*; do
  filename=${path##*/}
  paths=(../../node_modules/@*/"${filename%.d.ts}")
  [[ ! -d ${paths[0]} ]] || cp -u "$path" "${paths[0]}"/index.d.ts
done
job-list "$@" | grep '\.\(jsx\?\|tsx\?\)$' | grep -v '/__tests__/\|\.test\.' | exec xargs -r -d '\n' bash -"$-" -c $'
path=.tsconfig.json
sed \'s|\("include":\s*\)\[[^]]*\]|"files":\'"$(node -p \'JSON.stringify(process.argv.slice(1))\' -- "$@")"\'|\' "${path#.}" > "$path"
npx tsc -p "$path" || status=$?
rm "$path"
exit "${status-0}"
' --
