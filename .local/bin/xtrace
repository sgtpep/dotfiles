#!/bin/bash
set -eu
while :; do
  output=$(rlwrap -o -C "${0##*/}" -P '' -S "${1##*/}> " -b '' -g '^ ' -q '([' -s 10000 -w 0 cat)
  if [[ $output ]]; then
    bash -c "
. "\$1"
set -x
$output
" -- "$1" |& less
  else
    echo
    break
  fi
done
