#!/bin/bash
set -eu
while :; do
  if [[ ${2-} ]]; then
    code=$2
  else
    code=$(rlwrap -o -C "${0##*/}" -P '' -S "${1##*/}> " -b '' -g '^ ' -q '([' -s 10000 -w 0 cat)
  fi
  if [[ $code ]]; then
    [[ $1 != */* ]] || cd "${1%/*}"
    deno eval -T "
$(< "${1##*/}")
console.log($code)
"
    [[ $1 != */* ]] || cd - > /dev/null
    [[ ! ${2-} ]] || break
  else
    echo
    break
  fi
done
