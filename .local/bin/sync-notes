#!/bin/bash
set -eu
path=~/notes
command=(git -C "$path")
mapfile -t paths < <("${command[@]}" diff --name-only)
if [[ ${paths[@]} ]]; then
  "${command[@]}" add -A
  "${command[@]}" commit -m 'Update notes'
fi
"${command[@]}" pull 2>&1 || status=$?
if [[ -f $path/.git/REBASE_HEAD ]]; then
  "${command[@]}" add -A
  "${command[@]}" commit -m "$(< "$path"/.git/rebase-merge/message)"
  "${command[@]}" rebase --skip
else
  [[ ! -v status ]] || exit "$status"
fi
[[ ! ${paths[@]} ]] || "${command[@]}" push
