#!/bin/bash
set -eu
paths=(/sys/class/net/wl*)
command=(sudo wpa_cli -i "${paths[0]##*/}")
if [[ $@ ]]; then
  path=/etc/wpa_supplicant/wpa_supplicant.conf
  if [[ ${2-} ]]; then
    wpa_passphrase "$1" "$2" | sudo tee -a "$path" > /dev/null
  else
    sudo tee -a "$path" > /dev/null << EOF
network={
  key_mgmt=NONE
  ssid="$1"
}
EOF
  fi
  "${command[@]}" reconfigure
else
  "${command[@]}" scan
  sleep 1
  "${command[@]}" scan_results
fi
