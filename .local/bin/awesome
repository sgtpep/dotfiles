#!/bin/bash
set -eu
base_url=https://raw.githubusercontent.com/awesomeWM/awesome/v4.3/lib/gears
declare -A downloads=(
  [$base_url/math.lua]=0c426fce6df68143a16ae284d7910945
  [$base_url/string.lua]=226d58477c17c6736b5e1caac02f5257
  [$base_url/table.lua]=bfdc3169d6178651ae2d3b72b0bad601
)
for url in "${!downloads[@]}"; do
  path=~/.config/awesome/${url##*/}
  if [[ ! -f $path ]]; then
    wget -O "$path" "$url" || rm -f "$path"
    [[ $(md5sum "$path") == ${downloads[$url]}\ * ]] || rm -f "$path"
    sed -i 's/\("\)gears\./\1.\//' "$path"
  fi
done
path=/usr/bin/${0##*/}
[[ -x $path ]] || install-packages "${0##*/}"
exec "$path" "$@"
