#!/bin/bash
set -eu
output=$(job-list "$@" | grep '\.\(jsx\?\|tsx\?\)$')
exec xargs -r -a <(
  {
    grep '/__tests__/\|\.test\.' <<< $output || :
    {
      sed 's|/[^/]*$|/__tests__\0|' <<< $output
      {
        echo "$output"
        sed 's|/[^/]*$|/__tests__\0|' <<< $output
      } | sed 's/\.[^.]*$/.test\0/'
    } | xargs -d '\n' ls -d 2> /dev/null || :
  } | sort -u
) -d '\n' npm test -- --passWithNoTests
