#!/bin/bash
set -eu
directory=~/.config/chromium
if [[ ! -h $directory/SingletonLock ]]; then
  path=$directory/Default/Preferences
  content=$(< "$path")
  string='"content_settings":'
  [[ $content != *"$string"[{* ]] || sed -i 's/\('"$string"'\[\){[^]]*\(]\)/\1\2/' "$path"
  string='"gcpccpgdkmihefbjbhkipbjcpfaokokd":{"last_modified":'
  [[ $content != *"$string"* ]] || sed -i 's/\('"$string"'"[0-9]*","zoom_level":\)[0-9.]*/\10/' "$path"
fi
[[ -f ~/.job ]] || set -- --disable-notifications "$@"
command=chromium
set -- /usr/bin/"$command" --disable-features=TranslateUI --disable-infobars --disable-smooth-scrolling --enable-native-notifications --load-extension=/usr/share/chromium/extensions/ublock-origin "$@"
[[ -x $1 ]] || install-packages "$command" webext-ublock-origin
exec "$@"
