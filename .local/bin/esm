#!/bin/bash
set -eu
path=/tmp/${0##*/}.mjs
if [[ ! -f $path ]]; then
  cat > "$path" << \EOF
const url = new URL(`file://${process.cwd()}/`);
export const resolve = (specifier, parentModuleURL = url) => ({
  format: 'module',
  url: new URL(
    specifier,
    parentModuleURL.startsWith('eval:') ? url : parentModuleURL
  ).href
});
EOF
fi
NODE_OPTIONS='--experimental-modules --input-type=module --loader='"$path"' --no-warnings' . cjs
