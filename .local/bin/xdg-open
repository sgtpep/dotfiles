#!/bin/bash
set -eu
if [[ $1 =~ ^https?:// ]]; then
  exec x-www-browser -- "$1"
elif [[ $1 =~ ^mailto: ]]; then
  value=${1#*:}
  exec x-terminal-emulator -e mutt "${value%%\?*}"
else
  declare -A commands=(
    [application/msword]='libreoffice "$1"'
    [application/pdf]='mupdf "$1"'
    [application/vnd.ms-excel]='libreoffice "$1"'
    [application/vnd.openxmlformats-officedocument.spreadsheetml.sheet]='libreoffice "$1"'
    [application/vnd.openxmlformats-officedocument.wordprocessingml.document]='libreoffice "$1"'
    [audio/*]='mpv -- "$1"'
    [image/*]='sxiv -- "$1"'
    [image/svg]='x-www-browser -- "$1"'
    [image/webp]='x-www-browser -- "$1"'
    [text/html]='x-www-browser -- "$1"'
    [text/plain]='x-terminal-emulator -title vim -e vim -- "$1"'
    [text/rtf]='libreoffice "$1"'
    [video/*]='mpv -- "$1"'
  )
  mime=$(file -b --mime-type -- "$1")
  command=${commands[$mime]-${commands[${mime%/*}/*]-}}
  if [[ $command ]]; then
    eval "exec $command"
  else
    echo "Unknown mime type: $mime" >&2
    exit 1
  fi
fi
